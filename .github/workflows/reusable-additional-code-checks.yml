name: "Additional Code Checks"
# Additional code checks for the repository, won't block deployment if any checks fail.

# Reusable workflow for additional code checks, used in both pull requests (workflow called) and main branch pushes.

on:
  push:
    branches:
      - main
  workflow_call:

permissions:
  contents: read
  id-token: write

jobs:
  prettier-checks:
    name: "Prettier Checks"
    runs-on: ubuntu-latest
    steps:
      - name: "Checkout code"
        uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
        with:
          fetch-depth: 0
          persist-credentials: false
      - name: "Prettier Checks"
        uses: ./.github/actions/prettier-checks

  ruff-checks:
    name: "Ruff Checks"
    runs-on: ubuntu-latest
    steps:
      - name: "Checkout code"
        uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
        with:
          fetch-depth: 0
          persist-credentials: false
      - name: "Ruff Checks"
        uses: ./.github/actions/ruff-checks

  ruff-format:
    name: "Ruff Format"
    runs-on: ubuntu-latest
    steps:
      - name: "Checkout code"
        uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
        with:
          fetch-depth: 0
          persist-credentials: false
      - name: "Ruff Format"
        uses: ./.github/actions/ruff-format

  check-markdown-format:
    name: "Check Markdown Format"
    runs-on: ubuntu-latest
    timeout-minutes: 2
    steps:
      - name: "Checkout code"
        uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
        with:
          fetch-depth: 0
          persist-credentials: false
      - name: "Check Markdown Format"
        uses: ./.github/actions/check-markdown-format

  check-english-usage:
    name: "Check English Usage (vale)"
    runs-on: ubuntu-latest
    timeout-minutes: 2
    steps:
      - name: "Checkout code"
        uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
        with:
          fetch-depth: 0
          persist-credentials: false
      - name: "Check English Usage"
        uses: ./.github/actions/check-english-usage

  check-uv-lock:
    name: "Check pyproject.toml is Locked"
    runs-on: ubuntu-latest
    timeout-minutes: 2
    steps:
      - name: "Checkout code"
        uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
        with:
          fetch-depth: 0
          persist-credentials: false
      - name: "Check uv Lock"
        uses: ./.github/actions/check-uv-lock

  run-sandbox-unit-tests:
    name: "Run Sandbox Unit Tests"
    runs-on: ubuntu-latest
    timeout-minutes: 2
    steps:
      - name: "Checkout code"
        uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
        with:
          fetch-depth: 0
          persist-credentials: false
      - name: "Run unit tests"
        uses: ./.github/actions/run-unit-tests
        with:
          type_of_deployment: "sandbox"

  run-app-unit-tests:
    name: "Run App Unit Tests"
    runs-on: ubuntu-latest
    timeout-minutes: 2
    steps:
      - name: "Checkout code"
        uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
        with:
          fetch-depth: 0
          persist-credentials: false
      - name: "Run unit tests"
        uses: ./.github/actions/run-unit-tests
        with:
          type_of_deployment: "app"
